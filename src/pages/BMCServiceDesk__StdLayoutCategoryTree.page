<apex:page cache="true" showHeader="false" controller="BMCServiceDesk.StdCategoryTreeController" standardStylesheets="false" >
<link rel="stylesheet" type="text/css" href="{!$Resource.SDEFStyles}/CategorySearchStyle.css"/>
 <script>
    var popupId = '{!JSENCODE($CurrentPage.parameters.popupId)}';
    var recordId = '{!JSENCODE($CurrentPage.parameters.recordId)}';
    var stdForm = '{!JSENCODE($CurrentPage.parameters.stdForm)}';
    var state = '{!JSENCODE($CurrentPage.parameters.state)}';
	var categoryFilter='{!JSENCODE($CurrentPage.parameters.filter)}';
    var isServiceRequest = '{!JSENCODE($CurrentPage.parameters.serviceRequest)}';
    var idValStr = '{!JSENCODE($CurrentPage.parameters.idValStr)}';
    //fix for defect#69931 and #70213
    idValStr = encodeURIComponent(idValStr);
    var page_CMDBJsonGenerator = '{!$Page.CMDBJsonGenerator}';
    var labelRefresh = '{!JSENCODE($Label.Refresh)}';
    var labelCatByDesc = '{!JSENCODE($Label.CategoriesByDesc)}';
    var labelSearch = '{!JSENCODE($Label.Search)}';
    var labelSelCategory =  '{!JSENCODE($Label.SelectFromCategories)}';
    var incidentCategories = '{!JSENCODE($Label.Incident_Categories)}';
    var serviceRequestCategories = '{!JSENCODE($Label.Service_Request_Categories)}';
    var applyLabel = '{!JSENCODE($Label.Apply)}';
    var allCategoriesLabel = '{!JSENCODE($Label.AllCategories)}';
    var minCharsForSearchlabel = '{!JSENCODE($Label.GsErrorMsg)}';
    var warningTitleSearchLabel = '{!JSENCODE($Label.Warning)}';
    var selectCategoryLabel = '{!JSENCODE($Label.SelectCategoryCategorySearchPage)}';
    var incidentClosedLabel = '{!JSENCODE($Label.Incident_is_closed)}';
	var taskClosedLabel = '{!JSENCODE($Label.Task_is_Closed)}';
	var changeRequestClosedLabel = '{!JSENCODE($Label.CRClosed)}';
	var problemClosedLabel = '{!JSENCODE($Label.ProblemClosed)}';
	var releaseClosedLabel = '{!JSENCODE($Label.ReleaseClosed)}';
	var broadcastClosedLabel = '{!JSENCODE($Label.BroadcastClosed)}'; 
	var forSR = '{!JSENCODE($CurrentPage.parameters.forSR)}';
	var FormTag = '{!JSENCODE(FormTag)}'; 
	var TextBox = '{!JSENCODE(TextBox)}';
    var _RemoteActionGetCatDesc = '{!$RemoteAction.StdCategoryTreeController.fetchCategoryDesc}';
	var loadingImgSrc = '{!$Resource.SDEFStyles}/SDEFimages/loading.gif';
    var loadingText = '{!JSENCODE($Label.SSLoading)}...';
</script>
    <apex:form id="CategorySearchForm">
        <table class="clsMainTableC" cellpadding="5" cellspacing="0" height="100%;">
            <tr>
                <td><div id="btntoolbar"/></td>
            </tr>
			<tr>
			<apex:outputPanel rendered="{!isOptionalFilter}" >
				<td  class="LookupFilterTD" >
					<span id="showall" >
						{!$Label.ShowAllResultsMsg}
						<a style="padding-left:10px;"  href="javascript:toggleFilter(true)">{!$Label.ShowAllResultsLink}</a>
					</span>
					<span id="showfilter" style="display:none;">
					{!$Label.ReapplyCriteriaMsg}
					<a style="padding-left:10px;" href="javascript:toggleFilter(false)">{!$Label.ReapplyCriteriaLink}</a>
					</span>
				</td>	
           </apex:outputPanel>	
			</tr>
            <tr>
                <td>
                    <div id="categoryTreeView" style="overflow:auto;"/>
                </td>
            </tr>   
            <tr id="buttonpanel" >
                <td align="left" style="background-color:#dee0e0;height:35px;width:100%;">
                    <table>
                        <tr>
                            <td colspan="5"></td>
                            <td align="right">
                                <input tabindex="1" type="button" id="okButton" style="background-color:#dee0e0;font-family:arial;font-size:12px;height: 22px;margin-left: 10px;" onclick="validateRecordState()" value="{!$Label.Ok}" class="clsButtonStyle clsPrvBtn bgBtnGrey"/>  
                            </td>
                            <td align="right">
                                <input tabindex="1" type="button" id="cancelButton" style="background-color:#dee0e0;font-family:arial;font-size:12px;height: 22px;margin-left: 10px;" onclick="if (FormTag != undefined && FormTag == 'closepage') window.parent.popUpWindow.close(); else window.close();" value="{!$Label.Cancel}" class="clsButtonStyle clsPrvBtn bgBtnGrey"/>
                            </td>
                            <td width="5px"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <apex:outputPanel id="errorMsgPanel">
            <script>
                errorMsg = '{!JSENCODE(errorMessage)}';
            </script>
        </apex:outputPanel>
        <apex:actionFunction name="saveSelectedCategory" action="{!saveSelectedCategory}" reRender="errorMsgPanel" onComplete="closeWindowAfterSave();">
            <apex:param assignTo="{!selectedCategory}" name="selectedCategory" value=""/>
        </apex:actionFunction>
        <input id="hiddenTxtFld" style="display:none;"/><!-- prevents form submission when enter key is pressed on search text box -->
    </apex:form>    
    <c:CommonIncludes />                       
    <script type="text/javascript" src="{!$Resource.BMCRFCommonJS}/StdLayoutCategoryTree.js"/>
    <script type="text/javascript" src="{!$Resource.BMCRFCommonJS}/StdLayoutCommon.js"></script>
</apex:page>