<apex:page showHeader="false" Controller="BMCServiceDesk.DocController" sidebar="false" standardStylesheets="false">
<style>
	.customcss.x-window-dlg .x-window-body {
		overflow : visible !important;
	}
	.x-ie-shadow {
		background-color: transparent !important;
	}
</style>
<c:CommonIncludes />
 <apex:form id="attachMentMainForm">
    
        <apex:outputPanel id="formPanel">
            <table class="clsMainTable" cellspacing="0" cellpadding="0" border="0">
                <tr>
					<td colspan="2" class="clsTD100 TD15pxHeightCls" ></td>
				</tr>
				
				<tr>
					<td ><div class="div10pxHspacing"/></td>
					<td class="clsTD100" >
						<div id="errorDiv" style="color:red"> </div>	
					</td>
					
				</tr>
				<tr>
					<td colspan="2"><div class="div10pxVspacing"/></td>
				</tr>
				<tr>
					<td ><div class="div10pxHspacing"/></td>
					
					<td class="clsBoldInputLabelTD">
						<apex:outputLabel value="{!$Label.bmcservicedesk__reqdefimageselect}" />
					</td>
				</tr>
				 <tr>
					<td colspan="2"><div class="div10pxVspacing"/></td>
				</tr>
				 <tr>
					<td ><div class="div10pxHspacing"/></td>
					<td>
						<table cellspacing="0" cellpadding="0" border="0">
							<tr>
					<td colspan="2"><div class="div5pxVspacing"/></td>
					</tr>
					<tr>
																						
								<td ><div class="div20pxHspacing"/></td>
								<td class="clsTD100">
									<apex:inputFile accept="image/*" value="{!filebody}" filename="{!filename}" fileSize="{!filesize}"  contentType="{!contentType}" onchange="enableBtn();" id="inputfile" styleclass="inputfileCls"  size="51"/>
								</td>
							</tr>
							<tr>
								<td colspan="5" ><div class="div10pxVspacing"/></td>
							</tr>
							<tr>
								<td colspan="5" ><div class="div10pxVspacing"/></td>
							</tr>
							
						</table>
					</td>
				</tr>
			
				
				<tr class="row-gray">
					<td ><div class="div10pxHspacing"/></td>
					<td>
						<table cellspacing="0" cellpadding="0" border="0">
							<tr>
								<td colspan="2"><div class="div10pxVspacing"/></td>
							</tr>
							<tr>
							<td align="right"   >
                                <button name="add" id="file-add-btn"  type="button" Class="bgBtnGrey" onclick="AddAttachment()">{!JSENCODE($Label.Ok)}</button>
                                <button name="Cancel" id="file-Cancel-btn"  type="button" Class="bgBtnGrey" onclick="window.parent.closePopup();">{!JSENCODE($Label.Cancel)}</button>
                            </td>
							</tr>
							<tr>
								<td colspan="2"><div class="div10pxVspacing"/></td>
							</tr>
							<tr>
								<td colspan="2"><div class="div10pxVspacing"/></td>
							</tr>
						</table>
					</td>
				</tr>
            </table>
        </apex:outputPanel> 
        <apex:actionFunction name="confirmSave" action="{!confirmSave}">
	 </apex:actionFunction>
	 <apex:actionFunction name="deleteDocument" action="{!deleteDoc}">
	 </apex:actionFunction>
	 <apex:actionFunction name="SaveIcon" action="{!save}">
	 </apex:actionFunction>  
		<apex:outputPanel id="docId">
      <script>
            document.getElementById('file-add-btn').disabled=true;
            var IE8='{!isIE8}';
            var IE9='{!isIE9}';
			var IE10='{!isIE10}';
            var icon = Ext.MessageBox.ERROR ;
            var warningLabel ='{!JSENCODE($Label.Warning)}';
                    
                    
            
                if('{!isSaved}'== 'false'){
               		showError();
            	}          
       
				 function showError(){
                    msg = '{!JSENCODE(messageString)}';
                    var ReqDefImageWarningMsg='{!JSENCODE($Label.ReqDefImageWarningMsg)}';
                    if(msg!='' && msg == ReqDefImageWarningMsg ){ 
                       		Ext.MessageBox.confirm('{!JSENCODE($Label.ReqDefImageWarningMsgHeader)}', '{!JSENCODE($Label.ReqDefImageWarningMsg)}', function(btn){
                                            if(btn === 'yes'){
                                             	confirmSave();
                                            }
                                            if(btn === 'no'){
                                                deleteDocument();
                                            }
                                        });
                    }else if(msg!=''){
                      ShowMessage(msg);
                    }else{
                        confirmSave();
                    }
                }
  
                function enableBtn(){
                    document.getElementById('file-add-btn').disabled=false;
                }
                function ShowMessage(msg){
                		Ext.Msg.show({
                                title:warningLabel,
                                msg: msg,
                                buttons: Ext.Msg.OK,
                                width:'auto',
                                height:'auto',
                                icon: icon,
                                cls: 'customcss'
                        });
                }
              
      </script>

     </apex:outputPanel>    

     
        <script> 
        var ImageFileTypeValidationMsg='{!JSENCODE($Label.ReqDefImageFileTypeMsg)}';
        var ImageTypeValidationMsg='{!JSENCODE($Label.imageTypeValidation)}';
        var IconAttachmentLimit='{!JSENCODE($Label.IconAttachmentLimit)}';
        var size, typeofImage;
        
         function AddAttachment() {
                        var fileupload = document.getElementsByName('{!$Component.inputfile}'+':inputFile:file')[0];
                        if((typeof(fileupload.value) != 'undefined') && (typeof(fileupload.value) != 'undefined')){
                          if(IE8!='true' && IE9!='true' && IE10!='true'){    								//IE handling bacause IE8, 9 and 10 doesn't support fileupload.files[0] property
                                    if(fileupload.files[0] != null && fileupload.files[0]!=undefined){
                                         var typeOfDoc =fileupload.files[0].type;
                                         typeofImage = typeOfDoc.replace("image/","");
                                         size = fileupload.files[0].size;
                                         if (typeOfDoc.indexOf('image')!=-1){
                                         	checkImageFormat();
	                                     }else{
                                             ShowMessage(ImageFileTypeValidationMsg);
                                         }
                                    } 
                            }else{
                            			SaveIcon();
                            }
                     }
                }
                
         function checkImageFormat(){
         	if (typeofImage != null){
	         	if (typeofImage != 'jpg' && typeofImage != 'jpeg' && typeofImage != 'gif' && typeofImage != 'bmp' && typeofImage != 'png'){
	         		ShowMessage(ImageTypeValidationMsg);
	         		}else{
	         		  checkSize();
	                 }      
         	}
         }
         
         function checkSize(){
         	
                if(size <= 5242880){
                         if(size >= 1024*20){
                            Ext.MessageBox.confirm('{!JSENCODE($Label.ReqDefImageWarningMsgHeader)}', '{!JSENCODE($Label.ReqDefImageWarningMsg)}', function(btn){
                                            if(btn === 'yes'){
                                             SaveIcon();
                                            }
                                            if(btn === 'no'){
                                                deleteDocument();
                                            } 
                                        }); 
										
                         }else{
                                    SaveIcon();
                         }
                }else{
                        ShowMessage(IconAttachmentLimit);
                        }
         }
 </script>              
    </apex:form>
</apex:page>