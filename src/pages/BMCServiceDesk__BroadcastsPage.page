<apex:page showHeader="false" Controller="BMCServiceDesk.BroadcastController" contentType="{!contetnTypeForIE}" standardStylesheets="false">
 <c:CommonIncludes />
 <apex:stylesheet value="{!$Resource.BMCServiceDesk__ChatterCSS}/chatter.css" />
 <link rel="Stylesheet" type="text/css" href="{!$Resource.SDEFStyles}/BroadcastPage.css" />
 <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFCommonJS}/HTML_ENCODE_DECODE.js" />
 <apex:includeScript value="{!$Resource.BMCServiceDesk__SDEFCommonJS}/BroadcastPage.js"/>
    <script>
		var wid = '{!JSENCODE($CurrentPage.parameters.wid)}';        
		var isLookup = "{!JSENCODE($CurrentPage.parameters.islookup)}";
		
		resizeGridProgressionJS('{!JSENCODE(StageHTML)}','{!JSENCODE(objLabel)}',isLookup);
		var TextAreaOverflow='{!JSENCODE($Label.TextAreaOverflow)}';
		var TextAreaOverflowForChatter='{!JSENCODE($Label.TextAreaOverflowForChatter)}';
		var TextAreaOverflowForChatterComment='{!JSENCODE($Label.TextAreaOverflowForChatterComment)}';
		var EmptyValueForChatterComment = '{!JSENCODE($Label.EmptyValueForChatterComment)}';
		var ConfirmHomePage='{!JSENCODE($Label.ConfirmHomePage)}';
		var ChatterDeletePost='{!JSENCODE($Label.ChatterDeletePost)}';
		var ChatterDeleteComment='{!JSENCODE($Label.ChatterDeleteComment)}';
		var labelDelete = '{!JSENCODE($Label.Delete)}';
        labelDeleteBroadcastPage = '{!JSENCODE($Label.DeleteConfirmMessage)}',
		labelFollowUnfollow = '{!JSENCODE($Label.FollowUnfollow)}',
		labelSuggestedExperts = '{!JSENCODE($Label.SuggestedExperts)}',
		labelBroadcastChatterFeed = '{!JSENCODE($Label.BroadcastChatterFeed)}',
        labelBroadcastWindowHeaderSearchPage = '{!JSENCODE($ObjectType.Broadcasts__c.label)}',
        labelValidDateTime = '{!JSENCODE($Label.ValidDateTime)}',
        labelSelectFrom = '{!JSENCODE($Label.SelectFrom)}',
        labelQueue = '{!JSENCODE($Label.Queue)}',
        labelCloseBroadcast = '{!JSENCODE($Label.CloseBroadcast)}',
        labelNew = '{!JSENCODE($Label.New)}',
        labelSave = '{!JSENCODE($Label.Save)}',
        labelCopy = '{!JSENCODE($Label.Copy)}',
        labelReset = '{!JSENCODE($Label.Refresh)}',
        labelAssignTo = '{!JSENCODE($Label.AssignTo)}',
        labelIncidentsStaff = '{!JSENCODE($Label.IncidentsStaff)}',
        labelIncidentsSuggestedStaff = '{!JSENCODE($Label.IncidentsSuggestedStaff)}',
        labelIncidentMyself = '{!JSENCODE($Label.IncidentMyself)}',
        labelIncidentMemberofProfName = '{!JSENCODE($Label.IncidentMemberof)} {!JSENCODE(userObj.Profile.Name)}',
        labelActions = '{!JSENCODE($Label.Actions)}',
        labelIncidentClose = '{!JSENCODE($Label.Close)}',
        labelReopenBroadcast = '{!JSENCODE($Label.ReopenBroadcast)}',
        labelTooltipBroadCastsInactive = '{!JSENCODE($ObjectType.Broadcasts__c.fields.inactive__c.label)}',
        labelPreviousRecord = '{!JSENCODE($Label.PreviousRecord)}',
        labelNextRecord = '{!JSENCODE($Label.NextRecord)}',
        labelDragResizeClickCollapse = '{!JSENCODE($Label.DragResizeClickCollapse)}',
        labelClickToExpand = '{!JSENCODE($Label.ClickToExpand)}',
        labelInactive = '{!JSENCODE($ObjectType.Broadcasts__c.fields.inactive__c.label)}',
		labelSavedSuccessfully = '{!JSENCODE($Label.SavedSuccessfully)}'        
		labelSelectAccounts = '{!JSENCODE($Label.ValidateSelectAccounts)}'
		profileId = '{!$Profile.Id}',
		DeletedRecord = '{!JSENCODE($Label.DeletedRecord)}',
		Information = '{!JSENCODE($Label.Information)}',
        assignStaffState = {!assignStaffState},
        assignSuggestedStaffState = {!assignSuggestedStaffState},
        assignGroupState = {!assignGroupState},
        assignMyselfState = {!assignMyselfState},
        assignMemberOfGroupState = {!assignMemberOfGroupState},
        assignToQueue = {!assignToQueue},
        closeState = {!closeState},
        reOpenState = {!reOpenState},
        saveState = {!saveState},    
        broadcastFormComponent = '{!$Component.broadcastForm}',
		ProfileButtonComponentId = 'ProfileButtonId';
		cmpCategoryUrgency = '{!$Component.broadcastForm.pbarId.Incidentdetail.category__c_id_fkurgency__c}',
		broadcastFeedVal =  '{!broadcastFeed}';
        var wid2 = '{!JSENCODE($CurrentPage.parameters.wid)}',
        cookieName= 'ConfigureSI'+'{!userObj.Id}',
	    cookieValue = Ext.util.Cookies.get(cookieName);
	    var iFrameSrc;
	    var isInactive= '{!broadcast.inactive__c}';
	    var listStore, accountList, hasAccounts = false, csvAccountListparam='';
		var listData = [];

		var cols = new Array(2); 
		cols[1]='elID'; 
		cols[0]='Name';
		
		var isGridDisabled = true;
		var categoryRequired = '{!categoryRequired}';
		ClosedStage = '{!JSENCODE($Label.ClosedStage)}';	
		var closedStageName  = '{!JSENCODE(statusName)}';
		
		function DisplayMsg()
   		{
   			if((errormsg != null) && (errormsg != ''))
     			Ext.MessageBox.show({ msg: errormsg, buttons: Ext.MessageBox.OK});
   		}
		
		function initAccountList() {
			if(accountList!= null && typeof(accountList) != 'undefined')
				accountList.destroy();
			var colWidth;
			var reader = new Ext.data.ArrayReader({}, cols);
		    listStore = new Ext.data.Store({
		        reader: reader, data: listData,
    			sortInfo: {
    				field: 'Name',
    				direction: 'ASC' 
				}
		    });
		    if(listData.length > 8) 
		    	colWidth = Ext.isIE7?218:Ext.isIE8?218:Ext.isSafari?218:218;
		    else
		    	colWidth = Ext.isIE7?224:Ext.isIE8?234:Ext.isSafari?234:234;
			accountList = new Ext.grid.GridPanel({
				id: 'accountListPanel',
				disabled: isGridDisabled,
				store: listStore,
				renderTo: 'multiSelectBox',
				viewConfig: {
					scrollOffset: 0
				},
				style:'border:1px gray solid;',
				border:false,
				layout: 'fit',
				height:Ext.isIE7?195:Ext.isIE8?195:Ext.isSafari?195:195,
				sm: new Ext.grid.RowSelectionModel({singleSelect:true}),
				cm: new Ext.grid.ColumnModel({
					defaults: {
						width: colWidth
					},
		            columns:[{
					header: 'Account Name',
					id: 'Name',
					dataIndex: 'Name',
					renderer: function(value, metaData, record, rowIndex, colIndex, store) {
						metaData.attr = 'title="' + value + '"';
                        var shortvalue = value;
                        if(shortvalue.length > 30) {
                            shortvalue = shortvalue.substr(0, 30) + '...';
                        }
                        return shortvalue;
                    }
				}]}),
				header:false,
				listeners: {
					render: function(grid) {
					       if(!Ext.isIE7)
					       {
							grid.getView().el.select('.x-grid3-header').setStyle('display', 'none');
					       }
					}      
				}
			});
		}
		

        function getSDFStylesResPath(){
            var resPath = '{!$Resource.SDEFStyles}';
            return resPath;
        }
        function getToEveryoneFlag(){
            var everyoneFlag = '{!broadcast.BMCServiceDesk__toEveryone__c}';
            return everyoneFlag;
        }
        function getBroadcastExpirationDate (){
            var broadcastExpirationDate = '{!$Component.broadcastForm.broadcastExpirationDate}';
            return broadcastExpirationDate;
        }
		function getImpactIdname (){
            var impactIdname = '{!$Component.broadcastForm.pbarId.Incidentdetail.Impact__c_id_name}';
            return impactIdname;
        }
		function getUrgencyIdname (){
            var urgencyIdname = '{!$Component.broadcastForm.pbarId.Incidentdetail.Urgency__c_id_name}';
            return urgencyIdname;
        }		
		function getimpactIdVal (){
            var impactIdVal = '{!$Component.broadcastForm.pbarId.Incidentdetail.Impact__c_id_id}';
            return impactIdVal;
        }
		function getUrgencyIdVal (){
            var urgencyIdVal = '{!$Component.broadcastForm.pbarId.Incidentdetail.Urgency__c_id_id}';
            return urgencyIdVal;
        }
        function getCategoryIdName(){
            var categoryIdName = '{!$Component.broadcastForm.pbarId.Incidentdetail.category__c_id_name}';
            return categoryIdName;
        }
        function getBroadcastCategoryFK(){
            var broadcastCategoryFK = '{!$Component.broadcastForm.pbarId.Incidentdetail.broadcastcategoryfk}';
            return broadcastCategoryFK;
        }
        function getBroadcastResolution(){
            var broadcastResolution = '{!$Component.broadcastForm.broadcastResolution__c}';
            return broadcastResolution;
        }
        function getInactiveValue(){
            var inactiveValue = {!broadcast.inactive__c};
            return inactiveValue;
        }
        function getBroadcastId(){
            var broadcastId = '{!broadcast.Id}';
            return broadcastId;
        }
        function getBroadcastState(){
            var broadcastState = '{!broadcast.state__c}';
            return broadcastState;
        }
		function getStaffHiddeninputCmpId(){
            var staffHiddeninputCmp = '{!$Component.broadcastForm.staffHiddeninput}';
            return staffHiddeninputCmp;
        }		
		function getIsDirect(){
            return '{!JSENCODE($CurrentPage.parameters.isDirect)}';
        }
        function getWID(){
            return '{!JSENCODE($CurrentPage.parameters.wid)}';
        }
        function getID(){
            return '{!JSENCODE($CurrentPage.parameters.id)}';
        }
        function isRecordDeleted(){
    		return {!isRecDeleted};
    	}
        var broadcastIdSet;
        checkIDSet();
        function getBroadcastResolutionValue(){
            var broadcastResolution = '{!$Component.broadcastForm.broadcastResolution__c}';
            return document.getElementById(broadcastResolution).value;
        }
        function renderSIComponent(){
		     	
		     	if(cookieValue == true || cookieValue =='true')
		     		SIComp('/apex/SIContainerPage?oid='+broadcastId+'&otype=Broadcasts__c&wid='+wid+'&isChangeCreatable=false&isInactive='+isInactive);
		     	else{     
		     		var currentBroadcastId = '{!JSENCODE(currentBroadcastId)}';
		     		removeSI('/apex/SIContainerPage?oid=' + currentBroadcastId + '&otype=Broadcasts__c&wid='+wid+'&isChangeCreatable=false&isInactive='+isInactive);
		     	}	
	     
	     }
	     
		function enableRadio(){ // called on click of checkbox 'display in selfservice'
			if(document.getElementById('{!JSENCODE($Component.broadcastForm.pbarId.displayBroadcast.displayInSS)}').checked){
				document.getElementById('selectRadio:0').disabled = false;
				document.getElementById('selectRadio:1').disabled = false;
				document.getElementById('selectRadio:0').checked = true;
     			document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.AccountSelectBtn}').disabled = true;
				hasAccounts = true;
				radioAllAccounts();
			} else {
				document.getElementById('selectRadio:0').disabled = true;
				document.getElementById('selectRadio:1').disabled = true;
				document.getElementById('selectRadio:0').checked = false;
				document.getElementById('selectRadio:1').checked = false;
     			document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.AccountSelectBtn}').disabled = true;
				isGridDisabled = true;
				listData = [];
				initAccountList();
				hasAccounts=true;
			}
     	}
     	
     	function radioAllAccounts() {
     		hasAccounts = true;
     		isGridDisabled = true;
     		listData = [];
     		initAccountList();
     		csvAccountListparam = 'AllAccounts';
     		document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.AccountSelectBtn}').disabled = true;
     	}
     	
     	function radioSelectedAccounts() {
     		hasAccounts = false;
     		isGridDisabled = false;
     		document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.AccountSelectBtn}').disabled = false;
     		listData = [];
     		csvAccountListparam = '';
     		initAccountList();
     	}

		function openAccountSelector(returnValue) {
			if (returnValue != null) {
				var array = returnValue.data;
				listData = [];
				var param = '';
				var tempArr;
				for(i=0;i < array.length;i++){
					tempArr = new Array(2)
					tempArr[0] = returnValue.getAt(i).get('Name');
					tempArr[1] = returnValue.getAt(i).get('elID');
					param = param + returnValue.getAt(i).get('elID');
					if(i < array.length-1){
						param = param + ',';
					}
					listData.push(tempArr);
				} 
				csvAccountListparam = param;
                initAccountList();
				if(param.length > 0) {
                	hasAccounts = true;
                } else {
                	hasAccounts = false;
                }
            }
        }
    </script>    
<apex:outputPanel id="inactivePanel">
	<script>
		function updateInactive(){          
			Ext.getCmp('idInactive').setValue('{!broadcast.inactive__c}');        
		}    
	</script>
</apex:outputPanel>
<apex:outputPanel id="afterSavePanel">
	<script>
	   function handleSave(){
			handleSaveJS("{!broadcast.Id}");
		}
		function getChatterLimitErrorMessage(){
        	return '{!chatterLimitErrorMessage}';
        } 
	</script>
 </apex:outputPanel>
 <apex:outputPanel id="titlePanel">
	<script>
		isInactive= '{!broadcast.inactive__c}';
		function refreshRelatedPortlets(){
			refreshRelatedPortletsJS();
		}
		function resetSupportingInformation(isSave){
			resetSupportingInformationJS({!broadcast.state__c},'{!broadcast.Id}',isSave, {!broadcast.inactive__c});
		}
		function updateTitle(){
			var newTitle = "{!JSENCODE(broadcast.name)}";
			var StageHTML = '{!JSENCODE(StageHTML)}';
			if(newTitle != null && newTitle != '' && StageHTML != null && StageHTML != '')
			changeTitleAddStageProgressionJS(newTitle,StageHTML);
		}
	</script>
</apex:outputPanel>     
<apex:outputPanel id="checkPriorityCalculationPanel">
	<script>
		calculatePriority();    
		
		function loadChatterFeeds(){
					if(!this.FeedsVisible)
					{
						showChatterFeeds();
				    	this.FeedsVisible = true;
					}
				}	
   </script>
</apex:outputPanel>
<apex:outputPanel id="panelId">
	<script>
	 	objName = "{!JSENCODE(objName)}";
		initBroadCastJS('{!JSENCODE(categoryName)}','{!JSENCODE(broadcast.Id)}','{!broadcast.BMCServiceDesk__toEveryone__c}',"{!JSENCODE(broadcast.FKCategory__c)}");	   
		cookieValue = Ext.util.Cookies.get(cookieName);
                broadCastCloseState ='{!broadcast.state__c}';
        iFrameSrc='/apex/SIContainerPage?oid={!broadcast.Id}&otype=Broadcasts__c&wid='+wid+'&stateofIncident='+broadCastCloseState+'&isChangeCreatable=false&isInactive='+isInactive ;
       
       
	</script>
</apex:outputPanel>        
<apex:outputPanel id="errorId">
	<script>
	   errormsg = '{!JSENCODE(messageString)}';               
	</script>
</apex:outputPanel>
<apex:outputPanel id="dummy"></apex:outputPanel>
<apex:outputPanel id="varPanel">
	<script>
	   function checkEnable(){
			checkEnableJS({!assignMyselfState},{!assignStaffState},{!assignSuggestedStaffState},{!assignGroupState},{!assignToQueue},{!assignMemberOfGroupState},{!closeState},{!reOpenState},'{!broadcast.Id}');
	   }
	   function checkEnableToProfiles(obj){   
		   document.getElementById('ProfileButtonId').disabled=obj.checked;                 
		   if(obj.checked){
			   pName = document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.Proflie__c_id_name}').value;	
			   document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.Proflie__c_id_name}').value = '';
			   if(pName!= ''){
				   document.getElementById('{!$Component.broadcastForm.pbarId.displayBroadcast.Proflie__c_id_name}').value = '';
			   }
		   }
	   }
	   function checkEnableOnClose(){   
			Ext.getCmp('saveId').setDisabled({!saveState});                 
	   }
	   if(Ext.getCmp('saveId')!=null) {
			Ext.getCmp('saveId').setDisabled({!saveState});
	   }
	   function completeDelete(){
			completeDeleteJS('{!JSENCODE($Label.InsufficentDeletePrivilege)}');
	   }
	   function setCatData(id, name, catUrgency) {
	   		document.getElementById('{!$Component.broadcastForm.pbarId.Incidentdetail.Category__c_id_id}').value = id; 
        	document.getElementById('{!$Component.broadcastForm.pbarId.Incidentdetail.category__c_id_name}').value = name;
        	document.getElementById('{!$Component.broadcastForm.pbarId.Incidentdetail.category__c_id_fkurgency__c}').value = catUrgency;
        	FetchUrgencyHTTP();
        }
        function FetchUrgencyHTTP(){
        	var brId = '{!JSENCODE(broadcast.id)}';
        	FetchUrgencyHTTPJS('{!JSENCODE(broadcast.id)}', '{!$Component.broadcastForm.pbarId.Incidentdetail.Category__c_id_id}',
			null,
			'{!$Component.broadcastForm.pbarId.Incidentdetail.Impact__c_id_id}',
			null,
			'{!$Component.broadcastForm.pbarId.Incidentdetail.Urgency__c_id_name}',
			'{!$Component.broadcastForm.pbarId.Incidentdetail.Urgency__c_id_id}',
			'{!$Component.broadcastForm.pbarId.Incidentdetail.Priority__c_id_name}',
			'{!$Component.broadcastForm.pbarId.Incidentdetail.Priority__c_id_id}');
        }
	</script>
</apex:outputPanel>
    <apex:outputPanel > <!-- Page body in this panel -->
       
            <apex:form id="broadcastForm" >
                
     <div id="capsule" class="CapsuleDiv1"> 
     
                <c:ValidationComponent errorMsgList="{!messageString}" id="validationComponent"></c:ValidationComponent>
                <apex:actionFunction name="callInit" action="{!callInit}" rerender="panelId,varPanel,status__c_id_name,category__c_id_name,PanelbarOutputPanel,broadcastExpirationDate,broadcastResolution__c,closeDateTimeTxt,titlePanel,idBroadcastPicker,broadcastPanel,disableGridPanel" oncomplete="checkEnable();checkEnableOnClose();updateTitle();resetSupportingInformation(true);converdisabletoreadonly();renderAccList();"/>
                <apex:actionFunction name="closeBroadcastPage" rerender="{!broadcast.id}" />
                <apex:actionFunction name="deleteBroadcast" action="{!deleteBroadcast}" reRender="errorId,validationComponent" oncomplete="refreshRelatedPortlets();completeDelete();"/>
                <apex:actionFunction name="save" action="{!save}" reRender="varPanel,validationComponent,titlePanel,afterSavePanel,closeDateTime,panelId,errorId,broadcastPostDate,firstName,lastName,profile,phone,extension,staffPanel,staffPopupID,staffInfobtn,staffHiddeninput,queue,priority__c_id_name,allfeeds,tablePanel,broadcastPanel" oncomplete="waitMsg.hide();updateTitle();resetSupportingInformation(true);handleSave();checkEnable();buttonValidator();showError();handleElemEvent();converdisabletoreadonly();converdisabletoreadonly();refreshRelatedPortlets();renderAccList();rendersavebutton();">
                 <apex:param assignTo="{!chkBoxValue}" name="idSetString" value=""/>
                 <apex:param assignTo="{!csvAccountID}" name="csvAccount" value="AllAccounts"/>   
                </apex:actionFunction>
				<apex:actionFunction name="followBroadcastToggler" action="{!togglefollow}" reRender="closeopId,varPanel,validationComponent,titlePanel,afterSavePanel,closeDateTime,panelId,errorId,broadcastPostDate,firstName,lastName,profile,phone,extension,staffPanel,staffPopupID,staffInfobtn,staffHiddeninput,queue,priority__c_id_name,allfeeds" oncomplete="DisplayChatterLimitMessage();updateTitle();resetSupportingInformation(true);handleSave();checkEnable();buttonValidator();showError();handleElemEvent();converdisabletoreadonly();converdisabletoreadonly();refreshRelatedPortlets()">
                </apex:actionFunction>
		        <apex:actionFunction name="refreshFeed" action="{!doNothing}" reRender="allfeeds"></apex:actionFunction>

		        <apex:actionFunction name="shareStatusPost" action="{!shareTextFeedPost}" reRender="allfeeds" oncomplete="waitMsg.hide();">
		            <apex:param name="newstatus" assignTo="{!newstatus}" value=""/>
		        </apex:actionFunction> 

		        <apex:actionFunction name="NewCommentValue" action="{!AddComment}" reRender="allfeeds" oncomplete="waitMsg.hide();">
		            <apex:param name="newComment" assignTo="{!newComment}" value=""/>
		            <apex:param name="feedId" assignTo="{!feedId}" value=""/>
		        </apex:actionFunction> 

		        <apex:actionFunction name="deleteComment" action="{!DeleteComment}" reRender="errorId,allfeeds" oncomplete="DisplayMsg();">
		            <apex:param name="commentId" assignTo="{!commentId}" value=""/>
		            <apex:param name="createdById" assignTo="{!createdById}" value=""/>
		        </apex:actionFunction>
	   			<apex:actionFunction name="deletePost" action="{!DeletePost}" reRender="errorId,allfeeds" oncomplete="DisplayMsg();">
					<apex:param name="postId" assignTo="{!postId}" value=""/>
					<apex:param name="createdById" assignTo="{!createdById}" value=""/>
				</apex:actionFunction>
                <apex:actionFunction name="newBroadcast" action="{!newBroadcast}"/>
                <apex:actionFunction name="resetBroadcast" action="{!reset}"  rerender="inactivePanel,titlePanel,PanelbarOutputPanel,tablePanel,staffPopupID,broadcastPanel,disableGridPanel" oncomplete="updateInactive();handleResetChange();handleElemEvent();converdisabletoreadonly();renderAccList(); resetSupportingInformation(false);"/>
                <apex:actionFunction name="broadcastAssignToMyself" action="{!broadcastAssignToMyself}" rerender="firstName,lastName,profile,phone,extension,staffPanel,staffPopupID,staffInfobtn,staffHiddeninput,queue" oncomplete="waitMsg.hide();converdisabletoreadonly();refreshRelatedPortlets()"/>
                <apex:actionFunction name="reOpen" action="{!reOpenBroadcast}" reRender="panelId,varPanel,status__c_id_name,titlePanel,closeDateTime" oncomplete="checkEnable();updateTitle();resetSupportingInformation(false);handleElemEvent();converdisabletoreadonly();refreshRelatedPortlets()"/>                
                <apex:actionFunction name="populateUrgency" action="{!populateUrgency}" rerender="Urgency__c_id_id,Urgency__c_id_name,priority__c_id_name,calculate,checkPriorityCalculationPanel" oncomplete="converdisabletoreadonly();checkSave();" > 
                    <apex:param assignTo="{!urgencyId}" name="urgencyId" value=""/>
                </apex:actionFunction>
                
                <apex:actionFunction name="broadcastAssignToStaff" action="{!broadcastAssignToStaff}" rerender="firstName,lastName,profile,phone,extension,staffPanel,staffPopupID,staffInfobtn,staffHiddeninput,queue" oncomplete="waitMsg.hide();converdisabletoreadonly();refreshRelatedPortlets()"> 
                    <apex:param assignTo="{!staffName}" name="staffName" value=""/>
                     <apex:param assignTo="{!firstName}" name="firstName" value=""/>
                     <apex:param assignTo="{!lastName}" name="lastName" value=""/>
                     <apex:param assignTo="{!profile}" name="profile" value=""/>
                     <apex:param assignTo="{!phone}" name="phone" value=""/>
                     <apex:param assignTo="{!extension}" name="extension" value=""/>

                </apex:actionFunction>
                
                <apex:actionFunction name="broadcastAssignToSuggestedStaff" action="{!broadcastAssignToSuggestedStaff}" rerender="firstName,lastName,profile,phone,extension,staffPanel,staffPopupID,queue,staffHiddeninput,staffInfobtn" oncomplete="waitMsg.hide();converdisabletoreadonly();refreshRelatedPortlets()"> 
                    <apex:param assignTo="{!staffName}" name="staffName" value=""/>
                     <apex:param assignTo="{!firstName}" name="firstName" value=""/>
                     <apex:param assignTo="{!lastName}" name="lastName" value=""/>
                     <apex:param assignTo="{!profile}" name="profile" value=""/>
                     <apex:param assignTo="{!phone}" name="phone" value=""/>
                     <apex:param assignTo="{!extension}" name="extension" value=""/>

                </apex:actionFunction> 
                
                 <apex:actionFunction name="assignBroadcastTOQueue" action="{!assignBroadcastTOQueue}" rerender="dummy,varPanel,staffPanel,staffHiddeninput,staffInfobtn,staffPopupID,firstName,lastName,profile,phone,extension,queue" onComplete="waitMsg.hide();checkEnable();converdisabletoreadonly();refreshRelatedPortlets()"> 
                     <apex:param assignTo="{!queue}" name="queue" value=""/>
                 </apex:actionFunction>
                 
                 <apex:actionFunction name="populateProfileNames" action="{!populateProfileNames}" rerender="Proflie__c_id_name" oncomplete="converdisabletoreadonly();" > 
                     <apex:param name="profileId" value=""/>
                 </apex:actionFunction>
                               
                <apex:actionFunction action="{!nextBtnHandler}" name="nextBroadcastBtnHandler" oncomplete="renderAccList();renderSIComponent();checkEnable();updateTitle();resetSupportingInformation(false);handleSave();updateInactive();disableProfile();handleResetChange();handleElemEvent();converdisabletoreadonly();reloadSupportInfo();"
                                    rerender="varPanel,inactivePanel,titlePanel,broadcastPanelId,afterSavePanel, tablePanel, pbarId,staffPopupID,panelId,broadcastPanel,disableGridPanel" >  
                                    <apex:param assignTo="{!tempString}" name="idSetString" value=""/>
                </apex:actionFunction>
                <apex:actionFunction action="{!previousBtnHandler}" name="previousBroadcastBtnHandler" oncomplete="renderAccList();renderSIComponent();checkEnable();updateTitle();resetSupportingInformation(false);handleSave();updateInactive();disableProfile();handleResetChange();handleElemEvent();converdisabletoreadonly();reloadSupportInfo();"
                                    rerender="varPanel,inactivePanel,titlePanel,broadcastPanelId,afterSavePanel, tablePanel, pbarId,staffPopupID,panelId,broadcastPanel,disableGridPanel" > 
                                    <apex:param assignTo="{!tempString}" name="idSetString" value=""/>
                </apex:actionFunction>
                                  
                <apex:actionFunction name="broadcastSelectFromUser" action="{!broadcastSelectFromUser}" rerender="fromUserId" oncomplete="converdisabletoreadonly();"> 
                    <apex:param assignTo="{!fromUserId}" name="fromUserId" value=""/>
                </apex:actionFunction>
                <apex:actionFunction name="broadcastSelectToUser" action="{!broadcastSelectToUser}" rerender="toUserName" oncomplete="converdisabletoreadonly();" > 
                    <apex:param assignTo="{!toUserId}" name="toUserId" value=""/>
                </apex:actionFunction>
                
                
                
             <apex:actionFunction action="{!descriptionQuery}" name="setDescriptionNext" reRender="broadcastDescription__c" oncomplete="converdisabletoreadonly();"> 
                <apex:param assignTo="{!categoryDescriptionId}" name="categoryDescriptionId" value=""/>
            </apex:actionFunction>
            
            <apex:actionFunction action="{!categoryQuery}" name="setCategoryNext" reRender="panelId,Urgency__c_id_name" oncomplete="converdisabletoreadonly();checkSave();"> <!-- category__c_id_name, -->
                <apex:param assignTo="{!categoryId}" name="categoryId" value=""/>
            </apex:actionFunction>
            
            <apex:actionFunction action="{!resolutionQuery}" name="setResolutionNext" reRender="broadcastResolution__c"> 
               <apex:param assignTo="{!categoryResolutionId}" name="categoryResolutionId" value=""/>
           </apex:actionFunction>
                
                <apex:actionFunction name="populateImpact" action="{!populateImpact}" reRender="Impact__c_id_id,Impact__c_id_name,priority__c_id_name,calculate,checkPriorityCalculationPanel" oncomplete="converdisabletoreadonly();checkSave();" > 
                    <apex:param assignTo="{!impactId}" name="impactId" value=""/>
                </apex:actionFunction>
                
                 <apex:actionFunction name="populateStatus" action="{!populateStatus}" reRender="status__c_id_name" oncomplete="converdisabletoreadonly();checkSave();" > 
                    <apex:param assignTo="{!statusId}" name="statusId" value=""/>
                </apex:actionFunction>
                
                <apex:actionFunction name="calculatePriorityNext" action="{!calculatePriority}" reRender="priority__c_id_name,Priority__c_id_id" oncomplete="converdisabletoreadonly();checkSave();"/>
                    <table cellpadding="0" cellspacing="0" class="clsMainTableSI">
                        
                        <tr class="clsRowGreyBg">
                            <td colspan="3">
                                <div id="btnToolbar"></div>
                            </td>
                        </tr>
                        
                        <tr>
                        <td>
                          <table cellpadding="0" cellspacing="0" class="clsTable" >
                            <tr>
                                <td class="clsTopAlignment75">
                                    <apex:outputPanel id="tablePanel">                                
                                        <table cellpadding="0" cellspacing="0" class="clsTable">
                                            <tr>
                                               <td colspan="3"><div class="div15pxVspacing"></div></td>
                                            </tr>
                                            <tr>
                                                <td class="clsInputLabelTD" ><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.Name.label}" /><span class="clsRequiredBlack">&nbsp;*</span></td>
                                                <td class="clsInputTextBoxTD">
                                                    <apex:inputtext title="{!$Label.bmcservicedesk__tooltipbroadcastsbroadcastid}" id="broadcast_name_id" value="{!broadcast.name}" styleClass="clsIdInputTextBox" tabindex="501"/>
                                                </td>
                                            </tr>
                              <script>                                            
                                function setfocusforbroadcastid()
                                                {
                                          try{
                document.getElementById('{!$Component.broadcastForm.broadcast_name_id}').focus();
                }
                catch(e){
               
                }           
                                                }
                              </script>
                              <tr>
                                                <td   class="clsInputBoldLabelTableFirstRowTD" ><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastMessage__c.label}"/><span class="clsRequiredBlack">&nbsp;*</span></td>
                                           </tr>
                                            <tr>
                                                <td  colspan="3"  class="clsInputTextAreaTD" >
                                                  <div class="clsRelativePosition" >
                                                     <apex:inputTextarea title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastMessage__c.InlineHelpText}" id="broadcastMessage__c" value="{!broadcast.BMCServiceDesk__broadcastMessage__c}" styleClass="clsInputTextArea"  tabindex="502" />
                                                  </div>  
                                                </td>
                                            </tr>
                                            
                                            <tr>
                                                <td colspan="3"><div class="div15pxVspacing"/></td>
                                            </tr>
                                            
                                            <tr>
                                                <td colspan="2" class="clsInputCheckBox" style="padding-left :10px;padding-bottom : 5px;" >
                                                    <apex:inputCheckbox title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastTicker__c.InlineHelpText}" value="{!broadcast.BMCServiceDesk__broadcastTicker__c}" id="idBroadcastPicker" onblur="document.getElementById('{!$Component.broadcastExpirationDate}').focus()" tabindex="503"/> 
                                                    <label for="idBroadcastPicker" class="clsInputCheckBoxLabel">{!$ObjectType.Broadcasts__c.fields.broadcastTicker__c.label}</label>
                                                </td>
                                             </tr>
                                            
                                            <tr>
                                                <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__postDate__c.label}"/></td>
                                                <td class="clsInputTextBoxTD">
                                                    <apex:inputText title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__postDate__c.InlineHelpText}" value="{!postDate}" styleClass="clsIdInputTextBoxReadOnly" id="broadcastPostDate" disabled="true" onfocus="this.blur()"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="clsInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__expirationDate__c.label}"/></td>
                                               <td class="clsInputTextBoxTD" title="{!$ObjectType.Broadcasts__c.fields.expirationDate__c.inlineHelpText}">
                                                    <apex:inputField value="{!broadcast.BMCServiceDesk__expirationDate__c}" styleClass="clsInputTextBox" id="broadcastExpirationDate" onblur="document.getElementById('{!$Component.broadcastDescription__c}').focus()"/>
                                                </td>
                                            </tr>   
                                            
                                           <tr>
                                                <td   class="clsInputBoldLabelTDI" ><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastDescription__c.label}"/></td>
                                           </tr>
                                            <tr>
                                                <td  colspan="3"  class="clsInputTextAreaTD" >
                                                  <div class="clsRelativePosition">
                                                     <apex:inputTextarea title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastDescription__c.InlineHelpText}" id="broadcastDescription__c" value="{!broadcast.BMCServiceDesk__broadcastDescription__c}" styleClass="clsInputTextArea"   tabindex="504"/>
                                                  </div>  
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="clsInputBoldLabelTDI" ><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastResolution__c.label}"/></td> 
                                            </tr>
                                            <tr>
                                                 <td colspan="3" class="clsInputTextAreaTD">
                                                    <div class="clsRelativePosition">
                                                        <apex:inputTextarea title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__broadcastResolution__c.InlineHelpText}" id="broadcastResolution__c" value="{!broadcast.BMCServiceDesk__broadcastResolution__c}" styleClass="clsInputTextArea"   tabindex="505" />
                                                    </div>    
                                                </td>
                                             </tr>
                                            
                                        </table> 
                                        
                                        
                                        
                                    </apex:outputPanel>                                
                                </td>
                                 <td><div class="div17pxHspacing"/></td>
                                 <td class="clsTopAlignment25">
                                    <div class="panelCapsule">
                                        <apex:outputPanel id="PanelbarOutputPanel">
                                            <apex:panelBar headerClass="clsRowBlueBgPanel" switchType="ajax" id="pbarId" >
                                                <apex:panelBarItem label="{!$Label.bmcservicedesk__details}" expanded="true" id="Incidentdetail" headerClass="panelHeader" contentClass="panelContent">
                                                        <table cellpadding="0" cellspacing="0" class="clsTable">
                                                            <tr>
                                                                <td colspan="3"> <div class="div15pxVspacing"/></td>
                                                            </tr> 
                                                           
                                                            <tr style="{!categoryShowStyle}" >
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKCategory__c.label}"/><apex:outputLabel value=" *" styleClass="clsRequiredBlack" rendered="{!categoryRequired}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputText title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKCategory__c.InlineHelpText}" id="category__c_id_name" value="{!categoryName}" styleClass="clsPanelInputTextbox" tabindex="506" onblur="showalldata(event,FetchUrgencyHTTP,escape('inactive__c = false'));"/>
                                                                    <apex:inputhidden id="category__c_id_fkurgency__c"/>
                                                                    <apex:inputhidden id="category__c_id_id" value="{!broadcast.BMCServiceDesk__FKCategory__c}"/>             
                                                                                                 
                                                                 </td>
                                                                 <td class="lookupIconPanelTD"> <div class="lookUpIconDiv">
                                                                    <input type="button" class="lookupIconOn" id="categoryLookup" tabindex="507" onClick="if(!inProgress) {openPopup('CategorySearchPage?isLookup=true&isSD=true',openCategoryLookup);}" />
                                                                    </div>
                                                                    <apex:inputhidden value="{!categoryName}" id="broadcastcategoryfk" />
                                                                </td>
                                                            </tr>
                                                             <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKStatus__c.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                    <apex:inputText title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKStatus__c.InlineHelpText}" id="status__c_id_name" value="{!statusName}" styleClass="clsPanelInputTextbox" tabindex="508" onblur="showalldata(event,'',escape('inactive__c = false and appliesToBroadcasts__c = true'));"/>
                                                                </td>
                                                                 <td class="lookupIconPanelTD">
                                                                  <div class="lookUpIconDiv">
                                                                    <input type="button" id="statusLookup" class="lookupIconOn" onClick="if(!inProgress) {openPopup('SearchPage?popupId=Status&isLookup=true&filterClause='+escape('inactive__c = false and appliesToBroadcasts__c = true'),populateStatus);}" tabindex="509" />
                                                                 </div>
                                                                </td>
                                                            </tr>
                                                             <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKImpact__c.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                    <apex:inputText title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKImpact__c.InlineHelpText}" id="Impact__c_id_name" value="{!impactName}" styleClass="clsPanelInputTextbox" tabindex="510" onblur="showalldata(event,selectImpactOnName,escape('inactive__c = false')); "/>
                                                                                                        <apex:inputhidden id="Impact__c_id_id" value="{!broadcast.BMCServiceDesk__FKImpact__c}"/>
                                                                </td>
                                                                 <td class="lookupIconPanelTD">
                                                                    <div class="lookUpIconDiv">  
                                                                      <input type="button" id="impactlookup"  class="lookupIconOn" tabindex="511" onClick="if(!inProgress) { openPopup('SearchPage?popupId=Impact&isLookup=true&filterClause='+escape('inactive__c = false'),openImpactLookup);}" />
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKUrgency__c.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                    <apex:inputText title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKUrgency__c.InlineHelpText}" value="{!urgencyName}" styleClass="clsPanelInputTextbox" id="Urgency__c_id_name" tabindex="512" onblur="showalldata(event,selectUrgencyOnName,escape('inactive__c = false')); "/>
                                                                                                        <apex:inputhidden id="Urgency__c_id_id" value="{!broadcast.BMCServiceDesk__FKUrgency__c}"/>
                                                                </td>
                                                                 <td class="lookupIconPanelTD">
                                                                   <div class="lookUpIconDiv"> 
                                                                    <input type="button" id="urgencyLookup" class="lookupIconOn" onClick="if(!inProgress){openPopup('SearchPage?popupId=Urgency&isLookup=true&filterClause='+escape('inactive__c = false'),populateUrgency);}" tabindex="513"  />
                                                                   </div>
                                                                </td>
                                                            </tr>
                                                             <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKPriority__c.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                    <apex:inputText onfocus="this.blur()" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKPriority__c.InlineHelpText}" id="priority__c_id_name" value="{!priorityName}" disabled="true"  styleClass="clsPanelInputTextboxReadOnly"/>
                                                                    <apex:inputhidden id="Priority__c_id_id" value="{!broadcast.BMCServiceDesk__FKPriority__c}"/>
                                                                </td>
                                                            </tr>
                                                            <tr >                                                         
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__closeDateTime__c.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1"><apex:inputText onfocus="this.blur()" disabled="true" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__closeDateTime__c.InlineHelpText}" id="closeDateTime" value="{!closeDateTime}" styleClass="clsPanelInputTextboxReadOnly"/></td>
                                                                <!--<td class="clsPanelInputTextboxTD" colspan="2"><apex:inputField value="{!task.closeDateTime__c}" styleClass="clsPanelInputTextbox"/></td>-->
                                                            </tr>
                                                            
                                                        </table>
                                                         
                                                    </apex:panelBarItem>
                                                    <apex:panelBarItem label="{!staffAssignmentLabel}" headerClass="panelHeader staffAssignmentPanelHeader" contentClass="panelContent" id="staffAssignmentPanel">
					                              		<script>
					                              			var staffPanelBar = document.getElementById('{!$Component.staffAssignmentPanel}');
					                              			var i=0;
								                			if(staffPanelBar.childNodes.length > 0){
									                 			for(i=0; i<staffPanelBar.childNodes.length;i++){
									                 				if(staffPanelBar.childNodes[i] != null)
									                 					if(staffPanelBar.childNodes[i].className.indexOf('staffAssignmentPanelHeader') > 0){
									                 						staffPanelBar.childNodes[i].title = '{!JSENCODE($Label.StaffAssignmentDetails)}';
									                 					}
									                 			}                               			
								                			}
					                              		</script>
                                                        <table cellpadding="0" cellspacing="0" class="clsTable">
                                                            <tr>
                                                                     <td colspan="3" class="viewMoreDtlsBg">
                                                                    <button  type ="button" id="staffInfobtn" Class="bmcUserInfoPopup" onmouseover="showInfoPopup(event,'staffPopupDiv','staff');"/></td>
                                                            </tr>
                                                            <tr>
                                                                <td colspan="3">
                                                                    <div class="div15pxVspacing"/>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.User.fields.FirstName.label}"/></td>
                                                                <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" title="{!$Label.bmcservicedesk__tooltip_staffassignment_firstname}" disabled="true" value="{!firstName}"  styleclass="clsPanelInputTextboxReadOnly" id="firstName"/>
                                                                </td>
                                                              <td class="lookupIconPanelTD">&nbsp;</td>

                                                            </tr>
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.User.fields.LastName.label}"/></td>
                                                                 <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" title="{!$Label.bmcservicedesk__tooltip_staffassignment_lastname}" disabled="true" value="{!lastName}"  styleclass="clsPanelInputTextboxReadOnly" id="lastName"/>
                                                                </td>
                                                               <td class="lookupIconPanelTD">&nbsp;</td>

                                                            </tr>
                                                            
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.Profile.label}"/></td>
                                                                 <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" title="{!$Label.bmcservicedesk__tooltip_staffassignment_profile}" disabled="true" value="{!profile}"  styleclass="clsPanelInputTextboxReadOnly" id="profile"/>
                                                                </td>
                                                               <td class="lookupIconPanelTD">&nbsp;</td>
                                                            </tr>

                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.User.fields.Phone.label}"/></td>
                                                                 <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" title="{!$Label.bmcservicedesk__tooltip_staffassignment_phone}" disabled="true" value="{!phone}"  styleclass="clsPanelInputTextboxReadOnly" id="phone"/>
                                                                </td>
                                                               <td class="lookupIconPanelTD">&nbsp;</td>
                                                            </tr>
                                                            
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$ObjectType.User.fields.Extension.label}"/></td>
                                                                 <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" title="{!$Label.bmcservicedesk__tooltip_staffassignment_extension}" disabled="true" value="{!extension}"  styleclass="clsPanelInputTextboxReadOnly" id="extension"/>
                                                                </td>
                                                                 <td class="lookupIconPanelTD">&nbsp;</td>
                                                            </tr>
                                                            <tr>
                                                                <td class="clsPanelInputLabelTD"><apex:outputLabel value="{!$Label.bmcservicedesk__queue}"/></td>
                                                                 <td class="clsPanelInputTextboxTD1">
                                                                     <apex:inputtext onfocus="this.blur()" disabled="true" value="{!queue}"  styleclass="clsPanelInputTextboxReadOnly" id="queue" title="{!$Label.bmcservicedesk__tooltip_staffassignment_queue}"/>
                                                                </td>
                                                                <td class="lookupIconPanelTD">&nbsp;</td>
                                                            </tr>
                                                            
                                                        </table>
                                                    </apex:panelBarItem>
                                                    
                                                    <apex:panelBarItem label="{!$Label.bmcservicedesk__displaybroadcast}" id="displayBroadcast" headerClass="panelHeader" contentClass="panelContent">
                                                        
                                                        <table cellpadding="0" cellspacing="0" class="clsTable" >
                                                             <tr>                                                                
                                                                <td colspan="3"> <div class="div15pxVspacing"/></td>
                                                            </tr>
                                                             <tr >
                                                                
                                                                 <td class="clsPanelInputCheckboxTDS" colspan ="3" style="padding-left :10px;padding-bottom : 5px;" >
                                                                    <apex:inputCheckbox title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__toEveryone__c.InlineHelpText}" value="{!broadcast.BMCServiceDesk__toEveryone__c}" onclick="checkEnableToProfiles(this);" tabindex="515"/>
                                                                    <apex:outputLabel styleClass="clsPanelCheckBoxLabel"  value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__toEveryone__c.label}" />
                                                                </td>
                                                            </tr>
                                                            
                                                             <tr>
																<td colspan="3">
	                                                                <table cellpadding="0" cellspacing="0" class="clsTable">
	                                                                    <tr>
	                                                                        <td class="clsPanelInputLabelTD" ><apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Profiles__c.label}"/></td>
	                                                                        <td class="clsPanelInputTextboxTD1">
	                                                                            <apex:inputText onfocus="this.blur()" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Profiles__c.InlineHelpText}" id="Proflie__c_id_name"  value="{!broadcast.BMCServiceDesk__Profiles__c}" styleClass="clsPanelInputTextboxReadOnly"/>
	                                                                        </td>
	                                                                         <td class="lookupIconPanelTD">
	                                                                            <div class="lookUpIconDiv">  
	                                                                              <input type="button" id="ProfileButtonId" class="lookupIconOn" onClick="if(!inProgress) {openPopup('SearchPage?popupId=Profile&isLookup=true&useSOQLForSearch=true',populateProfileNames);}" />
	                                                                            </div>
	                                                                        </td>
	                                                                    </tr>
	                                                                </table>
																</td>
                                                            </tr>
                                                             <tr>
                                                                <td class="clsPanelInputCheckboxTDS" colspan="3" style="padding-left :10px;padding-bottom : 5px;">
                                                                    <apex:inputCheckbox id="displayInSS" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Display_In_SelfService__c.InlineHelpText}" value="{!broadcast.BMCServiceDesk__Display_In_SelfService__c}"  tabindex="514" onClick="enableRadio();"/>
                                                                    <apex:outputLabel styleClass="clsPanelCheckBoxLabel" value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Display_In_SelfService__c.label}"/>
                                                                </td>
                                                               
                                                            </tr>
                                                            <tr>
                                                                <td  colspan="3" style="padding-left :10px;" class="clsPanelInputCheckboxTDS">
																	<input type="radio" name="selectRadio" value="AllAccounts" id="selectRadio:0" onClick="radioAllAccounts();"/>
																	<label for="selectRadio:0" class="clsPanelCheckBoxLabel">{!$Label.BroadCastsToAllUsers}</label>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td  colspan="3" style="padding-left :10px;padding-bottom : 5px;" class="clsPanelInputCheckboxTDS">
																	<input type="radio" name="selectRadio" value="SelectedAccounts" id="selectRadio:1" onClick="radioSelectedAccounts();"/>
																	<label for="selectRadio:1" class="clsPanelCheckBoxLabel">{!$Label.BroadCastsToUsersofSelectedAccountsOnly}</label>
                                                                </td>
                                                            </tr>
                                                            <tr>
	                                                            <td colspan="3" class="clsPanelInputLabelTD"> 
	                                                            	<table cellpadding="0" cellspacing="0" class="clsTable"> 
	                                                            		<tr>
	                                                            			<td id="multiSelectBox"></td>
																			<td id="multiSelectBoxBtn" class="lookupIconPanelTD">
																				<div class="lookUpIconDiv">
																					<apex:commandbutton id="AccountSelectBtn" styleClass="lookupIconOn" onClick="if(!inProgress) {openPopupWithTitle('AccountSelector',openAccountSelector, '{!JSENCODE($Label.bmcservicedesk__broadcastaccountsselect)}', accSelHeight, accSelWidth);}" rerender="dummy" title="{!$Label.bmcservicedesk__broadcastaccountsselect}"/>
																				</div>
																			</td>
																		</tr>
																	</table>
																</td> 
                                                            </tr>
                                                         </table>
                                                    </apex:panelBarItem>                                                       
<apex:panelBarItem label="{!$Label.bmcservicedesk__broadcastchatterfeed}" onenter="loadChatterFeeds();"  headerClass="panelHeader" contentClass="panelContent" rendered="{!IF(broadcastFeed,true,false)}" id="BroadcastChatterFeed">
	<div style="padding-left:10px;">
	<table>
        	<tr>
        		<td height = "10"></td>
        	</tr>
    </table>
    <apex:outputPanel id="chatterContent" layout="block">
    <apex:actionFunction name="showChatterFeeds" action="{!showChatterFeeds}" rerender="chatterContent" />
    <apex:outputPanel id="allfeeds" layout="block" styleClass="feedcontainer" rendered="{!renderChatterPanel}">
        <apex:outputPanel layout="block" styleClass="" id="feed">
        <div class="publishercontainer ChatterAccordionPublisherContainer" >
        <div class="publisherrightcontainer">
	        <div class="publishercontrols">
	         	<apex:inputTextArea style="height: 0pt;" title="{!$Label.bmcservicedesk__tooltipchattersharebroadcast}" styleclass="publishertextarea ChatterAccordionTextAreaDefaultStyle _NoHandleChange" onclick="javascript:setOnClick(this)" onblur="javascript:setOnBlur(this,'{!newStatus}');" cols="1000" id="publishertextarea" value="{!newStatus}"></apex:inputTextArea>
	        </div>
        </div>
        	
		<table border="0" class="chattertable">
       		<tr>
       			<td><apex:commandLink styleClass="RecordFollowUnfollowLink" id="followunfollowLink" value="{!FollowUnfollowLinkLabel}" onclick="followBroadcastToggler(); return false;" /></td>
       			<td align="right"><apex:commandButton rerender="fullcomponentid" id="shareBTN" onclick="return shareTextPost(document.getElementById('{!$Component.publishertextarea}').value);" styleClass="btnShare"   value=" {!$Label.bmcservicedesk__share} "  title="{!$Label.bmcservicedesk__share}" /></td>
       		</tr>
       	</table> 	        	 	                
        </div>
    <apex:repeat value="{!myfeed}" var="f">
                <apex:outputPanel layout="block" styleClass="feedcontainer cxfeeditem feeditem cxfeedcontainer feed ">
                    <apex:outputPanel layout="block" >
                    <div class="cxfeeditemcontent">
                            <apex:outputText styleClass="ChatterAccordionCreatedBy" value="  {!f.feedItem.CreatedBy.Name} " />
                            <apex:outputPanel styleClass="feeditemtext" rendered="{!IF(f.feedItem.Type == 'UserStatus', true, false)}">
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value="{!f.displayText}" />
                            </apex:outputPanel>
                            <apex:outputPanel styleClass="feeditemtext" rendered="{!IF(f.feedItem.Type == 'TextPost', true, false)}">
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value="{!f.displayText}" />
                            </apex:outputPanel>
                            <apex:outputPanel styleClass="feeditemtext" rendered="{!IF(f.feedItem.Type == 'TrackedChange', true, false)}">
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value=" {!f.displayText}" />
                            </apex:outputPanel>
                            <apex:outputPanel styleClass="feeditemtext" rendered="{!IF(f.feedItem.Type == 'LinkPost', true, false)}">
                                    <apex:outputText styleClass="ChatterAccordionFeedItem" value="  {!f.feedItem.CreatedBy.Name} " />
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value="{!f.displayText}" />
                                <apex:outputPanel layout="block" styleClass="linkPostLinkContainer">
                                    <apex:outputLink value="{!f.feedItem.FeedPost.LinkUrl}" id="PostLink" styleClass="linkPostLink" target="_blank">
                                        <apex:outputText styleClass="ChatterAccordionFeedItem" id="PostLinkTxt" title="{!f.feedItem.FeedPost.LinkUrl}" value="{!f.feedItem.FeedPost.Title}" />
                                    </apex:outputLink>
                                </apex:outputPanel>
                            </apex:outputPanel>
                            <apex:outputPanel styleClass="feeditemtext" rendered="{!IF(f.feedItem.Type == 'ContentPost', true, false)}">
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value="  {!f.feedItem.CreatedBy.Name} " />
                                <apex:outputText styleClass="ChatterAccordionFeedItem" value="{!f.displayText}" />
                                <apex:outputPanel layout="block" styleClass="linkPostLinkContainer">
                                    <apex:outputText styleClass="ChatterAccordionFeedItemTitle" value="{!f.feedItem.FeedPost.Title}" />
                                </apex:outputPanel>                                
                            </apex:outputPanel>
                        </div>
                        <div class="feeditemfooter">
                            <span class="cxfeeditemcontent">
                                <apex:outputText value="{!f.createdDate}  "  styleClass="ChatterAccordionFeedItemSmall"  > 
                                </apex:outputText>
                                <apex:outputLink value="javascript:void(0);" onclick="setDisplay('{!JSENCODE(f.feedItem.id)}','block');">
                                    <apex:outputText styleClass="ChatterAccordionFeedItemActionLink"  value="  {!$Label.bmcservicedesk__comment}" />
                                </apex:outputLink>
                                    &nbsp;&nbsp;&nbsp;   
                                <apex:outputLink value="javascript:void(0);" onclick="deleteFeedPost('{!JSENCODE(f.feedItem.FeedPostId)}','{!JSENCODE(f.feedItem.CreatedById)}')" rendered="{!IF(f.feedItem.Type == 'TextPost' || f.feedItem.Type == 'LinkPost' || f.feedItem.Type == 'ContentPost', true, false)}">
                                    <apex:outputText styleClass="ChatterAccordionFeedItemActionLink" value="{!$Label.bmcservicedesk__delete}" />
                                </apex:outputLink>           
                            </span>  
                            <apex:actionRegion >
                              <div id="{!f.feedItem.id}" class="hidden feeditemcommenttext" style="padding-left:58px">
                                         <div class="cxfeeditemcontent" style="background-color:#EFF7FA; padding-top:2px">
                                               <apex:inputText styleClass="foobar cxnewcommenttext cxiswires _NoHandleChange" style="height: 20px; width:190px; padding-bottom:1px;"  value="{!currentComment}" title="{!$Label.bmcservicedesk__tooltipchattercomment}">
                                               </apex:inputText><br/>
                                                <apex:outputLink value="javascript:void(0);" onclick="createNewComment(document.getElementById('{!f.feedItem.id}'),'{!f.feedItem.id}');">
                                                    <apex:outputText styleClass="ChatterAccordionFeedItemActionLink"  value="{!$Label.bmcservicedesk__addcomment}" />
                                                </apex:outputLink>   
                                             <div class="feedclearfloat"></div>
                                         </div>
                             </div>
                            </apex:actionRegion>
                        </div> 
                        <apex:outputPanel id="commPanel" layout="block" styleClass="feeditemextras">
                            <div class="cxcomments feeditemcomments">
                                <apex:repeat value="{!f.feedCommentBeanList}" var="c">
                                    <apex:outputPanel layout="block" styleClass="" style="padding-left:12px">
                                        <span class="feeditemcomment cxfeedcomment feeditemcommentbody">
                                            <span class="feedcommentuser">
                                                    <apex:outputText styleClass="ChatterAccordionFeedItemActionLink"  value="{!c.createdByName} " />
                                            </span>
                                            <span class="feedcommenttext">
                                                 <apex:outputText styleClass="ChatterAccordionFeedItemSmall"  value="{!c.commentBody}" />
                                            </span>
                                            <span class="feedcommentfooter">
                                              <apex:outputText styleClass="ChatterAccordionFeedItemSmall feeditemtimestamp"  value="{!c.createdDate}">
                                               </apex:outputText>
                                            </span>
                                            <span class="feedresolutionfooter">
                                               <apex:outputText value="  " />
                                                <apex:outputLink value="javascript:void(0);" onclick="deleteCommentFromFeed('{!JSENCODE(c.commentId)}', '{!JSENCODE(c.createdById)}')" >
                                                    <apex:outputText styleClass="ChatterAccordionFeedItemSmall"  value="{!$Label.bmcservicedesk__delete}" />
                                                </apex:outputLink>           
                                                <apex:outputText value="  " /> 
                                            </span>
                                        </span>
                                    </apex:outputPanel>
                                </apex:repeat>
                            </div>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:repeat>  
            <apex:outputLink value="javascript:void(0);" rendered="{!moreFeed}" onclick="openNewTab('{!JSENCODE(currentBroadCastId)}', '{!JSENCODE(objectName)}');">
                <apex:outputText styleClass="ChatterAccordionFeedItemActionLink" value="  {!$Label.bmcservicedesk__more}" />
            </apex:outputLink>               
                                   </apex:outputPanel>
        <table class="clsTable" cellspacing="0" cellpadding="0">
        <tr>
            <td><apex:outputText styleClass="ChatterAccordionFeedLabel"  value="  {!$Label.bmcservicedesk__following}"/></td>        
        </tr>
        </table>                                    
                <apex:repeat value="{!userInfoList}" var="userInfo">
                    <apex:image id="theImage" value="{!userInfo.userImage}" title="{!userInfo.userName}" width="40" height="40" />&nbsp;
                </apex:repeat>
                                   </apex:outputPanel>
                              </apex:outputPanel>
                </div>                                
                                </apex:panelBarItem>
                                                    
                                                </apex:panelBar>
                                               </apex:outputPanel>
                                            </div>
                                </td>
                            </tr>
                            </table>
                            </td>
                        </tr>
                        <!-- <tr>
                            <td>
                                <c:detailSectionComponent objectName="Broadcasts__c" fKeyValue="{!currentBroadcastId}"/>  
                            </td>
                        </tr> -->
                    </table>
<!-- Code addded for Tool tip datoverflow bug -->
<!-- Addition over -->    
                   <div style="display:none">
                  <div>
                  <apex:outputpanel id="staffPopupID">
                       <div id="staffPopupDiv" >                           
                            <table  cellspacing="0" cellpadding ="0" >
                            <tr>
                                <td ><apex:inputHidden id="staffHiddeninput" value="{!user.Id}"/></td>
                                <td>
                                <table cellspacing="0" cellpadding ="0">
                                        <tr>
                                         <td style=" padding-top:5px; padding-left:4px; " class="clsInputBoldLabelTooltip1">                                        
                                         <div id="userNameforttdivId"></div> 
                                          </td>
                                        </tr>
                                        <tr style="{!IF(user.title=='','display:none','')}">
                                       
                                        <td style=" padding-top:1px; padding-bottom: 4px; padding-left:4px;" class="clsInputLabelTooltipTitle1">
                                       
                                        <div id="userTitleforttdivId"></div> 
                                        </td>
                                        </tr>
                                       <tr  style="{!IF(user.street=='','display:none','')}">
                                        <td style="padding-left:4px; padding-top:1px;" class="clsInputLabelTooltip1"> 
                                       
                                        <div id="userAddressforttdivId"> {!user.street} </div>  
                                       </td>
                                        </tr>
                                        
                                        <tr style="{!IF(user.city =='' && user.state =='' && user.Postalcode =='','display:none','')}">
                                        <td style="padding-left:4px;" class="clsInputLabelTooltip1">
                                        <div id="userCSZforttdivId"></div></td>
                                                                               </tr>
                                        <tr style="{!IF(user.country=='','display:none','')}">
                                        <td style="padding-left:4px;" class="clsInputLabelTooltip1">
                                        <div id="userCountryforttdivId"></div> 
                                        </td>
                                        </tr>
                                        <tr style="{!IF(user.Phone=='','display:none','')}">
                                        <td  style=" padding-top:5px;  padding-left:4px;" class="clsInputLabelTooltip1">
                                        <div id="userPhoneforttdivId"></div> 
                                        </td>
                                        </tr>
                                        <tr style="{!IF(user.email=='','display:none','')}">
                                        <td style="padding-bottom: 5px; padding-top: 1px; padding-left:4px;" class="clsInputLabelTooltip1">
                                        <div id="userEmailforttdivId"></div>
                                           </td>
                                         </tr>
                                </table>
                                </td>
                            </tr>
                           </table>
                        
                        </div> 
                        <script>
                          function tooltipforstaff(){
								var cszstringuser = formCSZString('{!JSENCODE(user.city)}','{!JSENCODE(user.state)}','{!JSENCODE(user.Postalcode)}');
								tooltipforstaffJS('{!JSENCODE(user.Name)}','{!JSENCODE(user.title)} ',cszstringuser,'{!JSENCODE(user.country)}','{!JSENCODE(user.Phone)}','{!JSENCODE(user.email)}');                          
                          }
                        </script>
                    </apex:outputpanel>
                </div> 
            </div>
        </div> 
        
        <!--  IE7-8 Related Changes -->
        
							   <div id="detailsDivSI">
						  <table  class="onDemandSITableCls" id="onDemandSITableId">
							  <tr>
								 <td id="noSIAvailTD">{!$Label.SIMessageForNewIncident}</td>
							  </tr>  
							  <tr >
								  <td id="linkSIAvailTD">
								  	<table class="SICheckboxLinkInnerTable">
	                              		<tr>
				                     	  	<td id="configureSITD">
				                      	  		<input type="checkbox" title="{!$Label.ShowSupportingInformation}" id="configureSIId" onClick="writeCookie();"/>&nbsp;{!$Label.SIMessageForConfiguration}
				                      	  		
				                      	  	</td>
				                      	</tr>
	                                	<tr>
	                                		<td>
                                                <a id="getSIUrl" href="JavaScript:void(0);" onClick="SIComp('/apex/SIContainerPage?oid='+broadcastId+'&otype=Broadcasts__c&wid='+wid+'&stateofIncident='+broadCastCloseState+'&isChangeCreatable=false&isInactive='+isInactive);" >{!$Label.SIMessageForExistingIncident}</a>
								  			</td>
                                		</tr>
                                    </table>
								  </td>
							  </tr>
						   </table>
						    <iframe name='SIIframeID' id='SIIframeID'  width='100%' height='100%' frameborder='0' style="display:none"/>
                        </div>
						
	<apex:outputPanel id="dummy"></apex:outputPanel>
	<apex:outputPanel id="broadcastPanel">
		<script>
		function renderAccList() {
			listData = {!accountJSON};
			enableDisableAccountRadio();
			initAccountList();
		}
		
		function enableDisableAccountRadio() {
    		var dispInSS = {!broadcast.BMCServiceDesk__Display_In_SelfService__c};
    		var isAllAccounts = {!isAllAccounts}; 
			hasAccounts = true;
			if(dispInSS){
				if(isAllAccounts) {
					document.getElementById('selectRadio:0').checked = true;
    				isGridDisabled = true;
    			} else {
    				document.getElementById('selectRadio:1').checked = true;
    				isGridDisabled = false;
    			}
    		} else {
    			document.getElementById('selectRadio:0').disabled = true;
				document.getElementById('selectRadio:1').disabled = true;
			}
    	}

    	csvAccountListparam = '{!JSENCODE(csvAccountID)}';
		var accSelHeight = Ext.isIE7?550:Ext.isIE8?550:Ext.isSafari?545:540;
		var accSelWidth = Ext.isIE7?510:Ext.isIE8?510:Ext.isSafari?510:510;
		isCreateable = {!isCreateable};
		isDeletable = {!isDeletable};
		isUpdateable = {!isUpdateable};
		</script>
	</apex:outputPanel>
	<c:TabOutComponent ></c:TabOutComponent>
<!--  Ends IE7-8 Related Changes Taken div inside form-->
	</apex:form>
	</apex:outputPanel>         
</apex:page>